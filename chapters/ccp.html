
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Common Conversion Point Stacking</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting" href="plotting.html" />
    <link rel="prev" title="Handling Receiver Functions" href="receiver_function.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="download.html">
   Waveform Download, preprocessing, and receiver function creation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="receiver_function.html">
   Handling Receiver Functions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Common Conversion Point Stacking
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plotting.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="API.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     PyGLImER
    </span>
   </code>
   API
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chapters/ccp.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lwsspy/lwsspy"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lwsspy/lwsspy/issues/new?title=Issue%20on%20page%20%2Fchapters/ccp.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/lwsspy/lwsspy/edit/master/chapters/ccp.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ccpstack-objects">
   CCPStack objects
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ccp-bins">
     CCP bins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-ccp-stack-in-pyglimer">
     Creating a CCP stack in PyGLImER
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="common-conversion-point-stacking">
<h1>Common Conversion Point Stacking<a class="headerlink" href="#common-conversion-point-stacking" title="Permalink to this headline">¶</a></h1>
<p>Provided that we have an extensive RF database for a certain geographic region,
we can create a volume of those receiver functions depending on piercing points
with varying grades of spatial averaging. Those volumes are referred to as <em>Common
Conversion Point (CCP)</em> stacks.</p>
<div class="section" id="ccpstack-objects">
<h2>CCPStack objects<a class="headerlink" href="#ccpstack-objects" title="Permalink to this headline">¶</a></h2>
<p>In <strong>PyGLImER</strong>, the base class enabling CCP stacking is the <a class="reference internal" href="API.html#pyglimer.ccp.ccp.CCPStack" title="pyglimer.ccp.ccp.CCPStack"><code class="xref py py-class docutils literal notranslate"><span class="pre">CCPStack</span></code></a> class.
However, to understand how CCP-Stacking is implemented,
we will have to have a small intermezzo about binning.</p>
<div class="section" id="ccp-bins">
<h3>CCP bins<a class="headerlink" href="#ccp-bins" title="Permalink to this headline">¶</a></h3>
<p>In <strong>PyGLImER</strong>, CCP bins are round in mapview (cylindric in 3D). If a piercing point of a receiver function is inside
of a bin, it will be added to this bin (i.e. there is one “station” stack in each bin). As such the shape of a bingrid is controlled
by two parameters: The bin’s radius R and the interbin distance d.</p>
<p>The bin radius decides, whether a piercing point is close enough (smaller
than R) to be added to the bin. High bin radii result in strong spatial averaging, which mitigates noise and can be helpful if the
illumination is low, whereas small radii have the potential of revealing small scale details.</p>
<p>Concerning the bin distance, we face a tradeoff between resolution and computational efficiency. Dense grids will take significantly
longer to compute and to plot than coarse grids. However, finely gridded bingrids have a higher resolution (much like pixels in a
digital image). It should be mentioned though that the resolution that can be reached this way is limited and depending on the bin radius.
In a way, higher bin radii introduce a blur to our image, which we cannot remove by decreasing the bin distance (much like we can upscale
our digital image, but the resolving power will not increase). Therefore, PyGLImER has a threshold for the bin radius.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The maximal bin radius allowed by PyGLImER equals 4 times the bin distance (to limit computational expense).
The minimal bin radius one should use is cos(30deg)*bin distance. For lower values the bingrid will not cover the whole surface area.</p>
</div>
</div>
<div class="section" id="creating-a-ccp-stack-in-pyglimer">
<h3>Creating a CCP stack in PyGLImER<a class="headerlink" href="#creating-a-ccp-stack-in-pyglimer" title="Permalink to this headline">¶</a></h3>
<p>CCP stacks in PyGLImER are usually not created by initialising the <a class="reference internal" href="API.html#pyglimer.ccp.ccp.CCPStack" title="pyglimer.ccp.ccp.CCPStack"><code class="xref py py-class docutils literal notranslate"><span class="pre">CCPStack</span></code></a> class but by calling the
<a class="reference internal" href="API.html#pyglimer.ccp.ccp.init_ccp" title="pyglimer.ccp.ccp.init_ccp"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_ccp()</span></code></a> function, which, itself, initialises the aforementioned object.</p>
<p>Using <a class="reference internal" href="API.html#pyglimer.ccp.ccp.init_ccp" title="pyglimer.ccp.ccp.init_ccp"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_ccp()</span></code></a>, there are two ways to create a <a class="reference internal" href="API.html#pyglimer.ccp.ccp.CCPStack" title="pyglimer.ccp.ccp.CCPStack"><code class="xref py py-class docutils literal notranslate"><span class="pre">CCPStack</span></code></a> object:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>By Creating a bingrid tailored to be used with data from predefined networks and stations (i.e. one
has to know network and station codes for the desired stack.</p></li>
<li><p>More commonly, one would like to create a CCP stack containing all available data for a given area.
In order to that, <a class="reference internal" href="API.html#pyglimer.ccp.ccp.init_ccp" title="pyglimer.ccp.ccp.init_ccp"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_ccp()</span></code></a> can be called with the <code class="docutils literal notranslate"><span class="pre">geocoords</span></code> parameter.
Then, PyGLImER will automatically find all stations available in the given area and create a bingrid around those data.</p></li>
</ol>
</div></blockquote>
<p><strong>Populating the CCP object</strong> is done by <a class="reference internal" href="API.html#pyglimer.ccp.ccp.init_ccp" title="pyglimer.ccp.ccp.init_ccp"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_ccp()</span></code></a> if called using the <code class="docutils literal notranslate"><span class="pre">compute_stack=True</span></code>
argument (recommended), else one will have to call <a class="reference internal" href="API.html#pyglimer.ccp.ccp.CCPStack.compute_stack" title="pyglimer.ccp.ccp.CCPStack.compute_stack"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_stack()</span></code></a>.</p>
<p><strong>Finalising the CCP object.</strong> Up to now data was only saved in the object and we have not created an actual CCP stack, yet.
We can do just that by calling <a class="reference internal" href="API.html#pyglimer.ccp.ccp.CCPStack.conclude_ccp" title="pyglimer.ccp.ccp.CCPStack.conclude_ccp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">conclude_ccp()</span></code></a>. Here, we can decide <strong>1.</strong> if we want to keep
empty bins <strong>2.</strong> what should be the threshold for a minimum amount of data per bin <strong>3.</strong> Whether we want to discards bins
that are on water surfaces or keep them.</p>
<p><strong>Saving our CCP object.</strong> The standard format to save these objects is pickle <cite>.pkl</cite>, which provides the fastest
reading speed. However, if you want to archive your data we recommend using the <strong>numpy npz</strong> format as older pickle
files can sometimes lead to compatibility issues after updating PyGLImER.
For compatibility with older plotting programs in Matlab (a legacy from GLImER), we can also save our CCP object as <cite>.mat</cite>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A ccp object saved as <cite>.mat</cite> will not save all data - only the finalised stack!</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you want to store your CCP Stack for a longer period of time, we recommend using the <em>npz</em> format to do so.</p>
</div>
</div>
</div>
</div>


              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="receiver_function.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Handling Receiver Functions</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="plotting.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Plotting</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Peter Makus, Lucas Sawade<br/>
        
            &copy; Copyright 2021, the PyGLImER development team.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>